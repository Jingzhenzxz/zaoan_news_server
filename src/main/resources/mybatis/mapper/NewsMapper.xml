<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wuan.wuan_news.wuan_news_server.mapper.NewsMapper">

    <resultMap id="NewsResultMap" type="com.wuan.wuan_news.wuan_news_server.model.News">
        <id column="id" property="id" />
        <result column="title" property="title" />
        <result column="description" property="description" />
        <result column="preview_image" property="previewImage" />
        <result column="pubDate" property="pubDate" />
        <result column="link" property="link" />
        <result column="author" property="author" />
        <result column="media_id" property="media.id" />
        <result column="created_at" property="createdAt" />
        <result column="updated_at" property="updatedAt" />
    </resultMap>

    <select id="getAllNews" resultMap="NewsResultMap">
        SELECT * FROM news
    </select>

    <select id="getNewsByMediaNameAndNewsTitle" resultMap="NewsResultMap">
        SELECT n.* FROM news n
        INNER JOIN media m ON n.media_id = m.id
        WHERE m.name = #{mediaName} AND n.title = #{newsTitle}
    </select>

    <insert id="insert" parameterType="com.wuan.wuan_news.wuan_news_server.dto.NewsDTO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `news` (`title`, `description`, `preview_image`, `pubDate`, `link`, `author`, `media_id`)
        VALUES (#{title}, #{description}, #{previewImage}, #{pubDate}, #{link}, #{author}, #{mediaId})
    </insert>

    <insert id="insertSelective" parameterType="com.wuan.wuan_news.wuan_news_server.dto.NewsDTO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `news`
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="title != null">`title`,</if>
            <if test="description != null">`description`,</if>
            <if test="previewImage != null">`preview_image`,</if>
            <if test="pubDate != null">`pubDate`,</if>
            <if test="link != null">`link`,</if>
            <if test="author != null">`author`,</if>
            <if test="mediaId != null">`media_id`,</if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="title != null">#{title},</if>
            <if test="description != null">#{description},</if>
            <if test="previewImage != null">#{previewImage},</if>
            <if test="pubDate != null">#{pubDate},</if>
            <if test="link != null">#{link},</if>
            <if test="author != null">#{author},</if>
            <if test="mediaId != null">#{mediaId},</if>
        </trim>
    </insert>

    <update id="update" parameterType="com.wuan.wuan_news.wuan_news_server.dto.NewsDTO">
        UPDATE `news`
        SET `title` = #{title},
        `description` = #{description},
        `preview_image` = #{previewImage},
        `pubDate` = #{pubDate},
        `link` = #{link},
        `author` = #{author},
        `media_id` = #{mediaId},
        WHERE `id` = #{id}
    </update>

    <update id="updateSelective" parameterType="com.wuan.wuan_news.wuan_news_server.dto.NewsDTO">
        UPDATE `news`
        <set>
            <if test="title != null">`title` = #{title},</if>
            <if test="description != null">`description` = #{description},</if>
            <if test="previewImage != null">`preview_image` = #{previewImage},</if>
            <if test="pubDate != null">`pubDate` = #{pubDate},</if>
            <if test="link != null">`link` = #{link},</if>
            <if test="author != null">`author` = #{author},</if>
            <if test="mediaId != null">`media_id` = #{mediaId},</if>
        </set>
        WHERE `id` = #{id}
    </update>
</mapper>
